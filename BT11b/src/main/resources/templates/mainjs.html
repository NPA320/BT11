$(document).ready(function () {

    // ===== HIỂN THỊ PROFILE (profile.html) =====
    $.ajax({
        type: "GET",
        url: "/users/me",
        dataType: "json",
        contentType: "application/json; charset=utf-8",
        beforeSend: function (xhr) {
            // Gửi token kèm request
            if (localStorage.token) {
                xhr.setRequestHeader("Authorization", "Bearer " + localStorage.token);
            }
        },
        success: function (data) {
            // Hiển thị thông tin user
            $("#profile").html(data.fullName ? data.fullName : data.email);
            if (data.images) {
                document.getElementById("images").src = data.images;
            }
            console.log("SUCCESS: ", data);
        },
        error: function (e) {
            console.error("ERROR: ", e);
            alert("⚠️ Sorry, you are not logged in.");
            window.location.href = "/login.html"; // quay lại login
        }
    });

    // ===== NÚT LOGOUT =====
    $("#LogoutBtn").click(function () {
        localStorage.clear(); // xoá token
        window.location.href = "/login.html"; // quay lại login
    });

    // ===== NÚT LOGIN (login.html) =====
    $("#LoginBtn").click(function () {
        var email = $("#email").val();
        var password = $("#password").val();

        var basicInfo = JSON.stringify({
            email: email,
            password: password
        });

        $.ajax({
            type: "POST",
            url: "/auth/login",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: basicInfo,
            success: function (data) {
                // Lưu token vào localStorage
                localStorage.token = data.token;
                console.log("Got JWT: " + data.token);
                alert("Login success!");
                window.location.href = "/profile.html";
            },
            error: function () {
                alert("❌ Login Failed");
            }
        });
    });

});
